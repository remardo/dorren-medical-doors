#!/bin/bash

# ะกะบัะธะฟั ะดะปั ัะตััะธัะพะฒะฐะฝะธั ัะฐะทะฒะตัััะฒะฐะฝะธั ะฝะฐ ัะตัะฒะตัะต
# ะัะฟะพะปัะทะพะฒะฐะฝะธะต: ./test-deployment.sh

echo "๐งช ะขะตััะธัะพะฒะฐะฝะธะต ัะฐะทะฒะตัััะฒะฐะฝะธั ะผะตะดะธัะธะฝัะบะธั ะดะฒะตัะตะน ะฝะฐ VPS..."
echo "=================================================="

# ะัะพะฒะตัะบะฐ 1: ะกัะฐััั nginx
echo "๐ ะจะฐะณ 1: ะัะพะฒะตัะบะฐ ััะฐัััะฐ nginx..."
sudo systemctl status nginx --no-pager -l

# ะัะพะฒะตัะบะฐ 2: ะะพะฝัะธะณััะฐัะธั nginx
echo -e "\n๐ ะจะฐะณ 2: ะัะพะฒะตัะบะฐ ะบะพะฝัะธะณััะฐัะธะธ nginx..."
sudo nginx -t

# ะัะพะฒะตัะบะฐ 3: ะัะพะฒะตัะบะฐ ัะฐะนะปะพะฒ ัะฐะนัะฐ
echo -e "\n๐ ะจะฐะณ 3: ะัะพะฒะตัะบะฐ ัะฐะนะปะพะฒ ัะฐะนัะฐ..."
if [ -f "/var/www/medical-doors/dist/index.html" ]; then
    echo "โ index.html ะฝะฐะนะดะตะฝ"
    head -5 /var/www/medical-doors/dist/index.html
else
    echo "โ index.html ะฝะต ะฝะฐะนะดะตะฝ ะฒ /var/www/medical-doors/dist/"
fi

# ะัะพะฒะตัะบะฐ 4: ะัะฐะฒะฐ ะดะพัััะฟะฐ
echo -e "\n๐ ะจะฐะณ 4: ะัะพะฒะตัะบะฐ ะฟัะฐะฒ ะดะพัััะฟะฐ..."
ls -la /var/www/medical-doors/dist/ | head -10

# ะัะพะฒะตัะบะฐ 5: ะัะพะฒะตัะบะฐ ะฟะพััะพะฒ
echo -e "\n๐ ะจะฐะณ 5: ะัะพะฒะตัะบะฐ ะฟะพััะพะฒ..."
sudo netstat -tlnp | grep :80 || echo "โ ะะพัั 80 ะฝะต ัะปััะฐะตััั"

# ะัะพะฒะตัะบะฐ 6: ะขะตัั HTTP ะทะฐะฟัะพัะฐ
echo -e "\n๐ ะจะฐะณ 6: ะขะตัั HTTP ะทะฐะฟัะพัะฐ..."
if command -v curl &> /dev/null; then
    curl -I http://localhost 2>/dev/null | head -5 || echo "โ HTTP ะทะฐะฟัะพั ะฝะต ัะดะฐะปัั"
else
    echo "โ๏ธ  curl ะฝะต ัััะฐะฝะพะฒะปะตะฝ"
fi

# ะัะพะฒะตัะบะฐ 7: ะะพะณะธ ะพัะธะฑะพะบ
echo -e "\n๐ ะจะฐะณ 7: ะะพัะปะตะดะฝะธะต ะพัะธะฑะบะธ ะฒ ะปะพะณะฐั..."
sudo tail -10 /var/log/nginx/medical-doors_error.log 2>/dev/null || echo "โ ะะพะณ ะพัะธะฑะพะบ ะฝะตะดะพัััะฟะตะฝ"

# ะัะพะฒะตัะบะฐ 8: ะัะพัะตััั
echo -e "\n๐ ะจะฐะณ 8: ะะบัะธะฒะฝัะต ะฟัะพัะตััั nginx..."
ps aux | grep nginx | grep -v grep

echo -e "\n๐ฏ ะขะตััะธัะพะฒะฐะฝะธะต ะทะฐะฒะตััะตะฝะพ!"
echo "=================================================="
echo "๐ ะัะปะธ ะฒัะต ัะฐะณะธ ะฟะพะบะฐะทัะฒะฐัั โ, ัะฐะนั ะดะพะปะถะตะฝ ัะฐะฑะพัะฐัั ะบะพััะตะบัะฝะพ"
echo "๐ ะัะพะฒะตัััะต ัะฐะนั ะฒ ะฑัะฐัะทะตัะต: http://your-vps-ip"